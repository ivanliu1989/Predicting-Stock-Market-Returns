setwd("C:\\Documents and Settings\\Macro\\Desktop\\Ivandata\\Predicting-Stock-Market-Returns")
library(tseries)
library(xts)
GSPC <- as.xts(get.hist.quote("^GSPC",start="1970-01-02",end="2009-09-15",
quote=c("Open", "High", "Low", "Close","Volume","AdjClose")))
GSPC[c(1,nrow(GSPC))]
library(quantmod)
getSymbols("^GSPC", from = "1970-01-01", to = "2009-09-15")
colnames(GSPC) <- c("Open", "High", "Low", "Close", "Volume", "AdjClose")
GSPC[c(1,nrow(GSPC))]
class(GSPC)
GSPC <- as.xts(get.hist.quote("^GSPC",start="1970-01-02",end="2009-09-15",
quote=c("Open", "High", "Low", "Close","Volume","AdjClose")))
class(GSPC)
GSPC1 <- as.xts(get.hist.quote("^GSPC",start="1970-01-02",end="2009-09-15",
quote=c("Open", "High", "Low", "Close","Volume","AdjClose")))
library(quantmod)
getSymbols("^GSPC", from = "1970-01-01", to = "2009-09-15")
colnames(GSPC) <- c("Open", "High", "Low", "Close", "Volume", "AdjClose")
identical(GSPC,GSPC1)
class(GSPC1)
class(GSPC)
head(GSPC)
head(GSPC1)
GSPC <- as.xts(get.hist.quote("TAP.AX",start="1970-01-02",end="2009-09-15",
quote=c("Open", "High", "Low", "Close","Volume","AdjClose")))
head(GSPC)
GSPC[nrow(GSPC)]
GSPC <- as.xts(get.hist.quote("TAP.AX",start="1970-01-02",
quote=c("Open", "High", "Low", "Close","Volume","AdjClose")))
GSPC[nrow(GSPC)]
setSymbolLookup(IBM=list(name='IBM',src='yahoo'),
USDEUR=list(name='USD/EUR',src='oanda'))
getSymbols(c('IBM','USDEUR'))
head(IBM)
head(USDEUR)
?HLC
HLC(GSPC)
head(HLC(GSPC))
head(GSPC)
v <- apply(HLC(GSPC), 1, mean)
head9v
head(v)
getSymbols("TAP.AX", from = "1970-01-01", #to = "2009-09-15"
)
colnames(TAP.AX) <- c("Open", "High", "Low", "Close", "Volume", "AdjClose")
head(TAP.AX)
tail(TAP.AX)
setSymbolLookup(TAP=list(name='TAP.AX',src='yahoo'),
IBM=list(name='IBM',src='yahoo'),
USDEUR=list(name='USD/EUR',src='oanda'))
getSymbols(c('TAP.AX','IBM','USDEUR'))
head(TAP.AX)
?saveSymbolLookup
saveSymbolLookup("tap.csv",choose.dir())
apply(HLC(TAP.AX), 1, mean)
r <- matrix(NA, ncol = 10, nrow = NROW(TAP.AX))
r
NROW(TAP.AX)
tail(TAP.AX)
TAP.AX
summary(TAP.AX)
str(TAP.AX)
nrow(TAP.AX)
NROW(TAP.AX)
identical(nrow(TAP.AX),NROW(TAP.AX))
?Delt
?Next
Stock.Close <- c(102.12,102.62,100.12,103.00,103.87,103.12,105.12)
Close.Dates <- as.Date(c(10660,10661,10662,10665,10666,10667,10668),origin="1970-01-01")
Stock.Close <- zoo(Stock.Close,Close.Dates)
Stock.Close
Next(Stock.Close)
Stock.Close <- c(102.12,102.62,100.12,103.00,103.87,103.12,105.12)
Close.Dates <- as.Date(c(10660,10661,10662,10665,10666,10667,10668),origin="1970-01-01")
Stock.Close <- zoo(Stock.Close,Close.Dates)
Next(Stock.Close,k=1)
Next(Stock.Close,k=2)
Next(Stock.Close,k=3)
merge(Next(Stock.Close),Stock.Close)
apply(HLC(TAP.AX), 1, mean)
v <- apply(HLC(TAP.AX), 1, mean)
r <- matrix(NA, ncol = 10, nrow = nrow(TAP.AX))
r
r[, 1] <- Next(Delt(v, k = 1), 1)
r
r[, 2] <- Next(Delt(v, k = 2), 2)
head(r)
Delt(v, k = 2)
head(Delt(v, k = 2))
head(Delt(v, k = 1))
head(Delt(v, k = 0))
head(Delt(v, k = 3))
Next(Delt(v, k = 3), 3)
head(Delt(v, k = 3))
head(Next(Delt(v, k = 3), 3))
head(Next(Delt(v, k = 3), 2))
head(Next(Delt(v, k = 3)))
time(TAP.AX)
head(TAP.AX)
head(v)
head(Delt(v))
head(Delt(v,2))
head(Delt(v,k=2))
for (x in 1:10) r[, x] <- Next(Delt(v, k = x), x)
tail(r)
T.ind <- function(quotes, tgt.margin = 0.025, n.days = 10) {
v <- apply(HLC(quotes), 1, mean) # HLC()-subset High, Low and Close. Apply - calculate avg of those three by row
r <- matrix(NA, ncol = n.days, nrow = nrow(quotes)) # nrow * n.days matrix with NA
for (x in 1:n.days) r[, x] <- Next(Delt(v, k = x), x) # Delt() - calculate the k-period percent diff between n and n+x.
x <- apply(r, 1, function(x) sum(x[x > tgt.margin | x < -tgt.margin])) # sum % change larger than 0.025 in r, if >0 good, <0 bad.
if (is.xts(quotes))
xts(x, time(quotes))
else x
}
?candleChart
?last
last(TAP.AX, "3 months")
candleChart(last(TAP.AX, "3 months"), theme = "white", TA = NULL)
avgPrice <- function(p) apply(HLC(p), 1, mean)
addAvgPrice <- newTA(FUN = avgPrice, col = 1, legend = "AvgPrice")
addT.ind <- newTA(FUN = T.ind, col = "red", legend = "tgtRet")
addAvgPrice(on = 1)
addT.ind()
png("TAP.png")
candleChart(last(TAP.AX, "3 months"), theme = "white", TA = NULL)
avgPrice <- function(p) apply(HLC(p), 1, mean)
addAvgPrice <- newTA(FUN = avgPrice, col = 1, legend = "AvgPrice")
addT.ind <- newTA(FUN = T.ind, col = "red", legend = "tgtRet")
addAvgPrice(on = 1)
addT.ind()
dev.off()
library(TTR)
myATR <- function(x) ATR(HLC(x))[, "atr"]
mySMI <- function(x) SMI(HLC(x))[, "SMI"]
myADX <- function(x) ADX(HLC(x))[, "ADX"]
myAroon <- function(x) aroon(x[, c("High", "Low")])$oscillator
myBB <- function(x) BBands(HLC(x))[, "pctB"]
myChaikinVol <- function(x) Delt(chaikinVolatility(x[, c("High", "Low")]))[, 1]
myCLV <- function(x) EMA(CLV(HLC(x)))[, 1]
myEMV <- function(x) EMV(x[, c("High", "Low")], x[, "Volume"])[,2]
myMACD <- function(x) MACD(Cl(x))[, 2]
myMFI <- function(x) MFI(x[, c("High", "Low", "Close")], x[, "Volume"])
mySAR <- function(x) SAR(x[, c("High", "Close")])[, 1]
myVolat <- function(x) volatility(OHLC(x), calc = "garman")[,1]
library(randomForest)
data.model <- specifyModel(T.ind(TAP.AX) ~ Delt(Cl(TAP.AX),k=1:10) +
myATR(TAP.AX) + mySMI(TAP.AX) + myADX(TAP.AX) + myAroon(TAP.AX) +
myBB(TAP.AX) + myChaikinVol(TAP.AX) + myCLV(TAP.AX) +
CMO(Cl(TAP.AX)) + EMA(Delt(Cl(TAP.AX))) + myEMV(TAP.AX) +
myVolat(TAP.AX) + myMACD(TAP.AX) + myMFI(TAP.AX) + RSI(Cl(TAP.AX)) +
mySAR(TAP.AX) + runMean(Cl(TAP.AX)) + runSD(Cl(TAP.AX)))
head(TAP.AX)
colnames(TAP.AX) <- c("Open", "High", "Low", "Close", "Volume", "AdjClose")
head(TAP.AX)
data.model <- specifyModel(T.ind(TAP.AX) ~ Delt(Cl(TAP.AX),k=1:10) +
myATR(TAP.AX) + mySMI(TAP.AX) + myADX(TAP.AX) + myAroon(TAP.AX) +
myBB(TAP.AX) + myChaikinVol(TAP.AX) + myCLV(TAP.AX) +
CMO(Cl(TAP.AX)) + EMA(Delt(Cl(TAP.AX))) + myEMV(TAP.AX) +
myVolat(TAP.AX) + myMACD(TAP.AX) + myMFI(TAP.AX) + RSI(Cl(TAP.AX)) +
mySAR(TAP.AX) + runMean(Cl(TAP.AX)) + runSD(Cl(TAP.AX)))
T.ind(TAP.AX)
Cl(TAP.AX)
head(Cl(TAP.AX))
?Cl
Delt(Cl(TAP.AX),k=1:10)
Delt(Cl(TAP.AX),k=10)
Delt(Cl(TAP.AX),k=2)
head(Cl(TAP.AX))
head(Cl(TAP.AX)[,1:2])
head(myATR(TAP.AX))
myATR(TAP.AX)
mySMI(TAP.AX)
TAP.AX <- HLC(TAP.AX)
Delt(Cl(TAP.AX),k=1:10)
Cl(TAP.AX)
head(Cl(TAP.AX))
head(TAP.AX)
mySMI(TAP.AX)
myADX(TAP.AX)
head(myADX(TAP.AX))
head(myAroon(TAP.AX))
head(myBB(TAP.AX))
head(myChaikinVol(TAP.AX))
head(myCLV(TAP.AX))
CMO(Cl(TAP.AX))
EMA(Delt(Cl(TAP.AX)))
myEMV(TAP.AX)
myVolat(TAP.AX)
myMACD(TAP.AX)
ex.model <- specifyModel(T.ind(IBM) ~ Delt(Cl(IBM), k = 1:3))
data <- modelData(ex.model, data.window = c("2009-01-01", "2009-08-10"))
m <- myFavouriteModellingTool(ex.model@model.formula, as.data.frame(data))
data
